# OpenEMR EKS Project - Version Management Configuration
# This file centralizes all version information for awareness and notifications
# Updated for monthly automated version checking with AWS CLI integration


# Core Application Versions
applications:
  openemr:
    current: "8.0.0"
    registry: "openemr/openemr"
    release_notes_url: "https://hub.docker.com/r/openemr/openemr/tags"
    notify_on_update: true
    requires_aws_cli: false
    description: "Version of OpenEMR docker image we use."

  fluent_bit:
    current: "4.2.3"
    registry: "fluent/fluent-bit"
    notify_on_update: true
    requires_aws_cli: false
    description: "Version of Fluent Bit sidecar for OpenEMR that sends logs to CloudWatch Log Groups."

  python:
    current: "3.14"
    registry: "library/python"
    tag_pattern: "3\\.[0-9]+(-slim)?"
    auto_detect_latest: true
    notify_on_update: true
    requires_aws_cli: false
    description: "Python Docker image version for Warp Kubernetes jobs and credential rotation container (tools/credential-rotation/Dockerfile). Automatically detects latest 3.xx version."

# Infrastructure Versions
infrastructure:
  eks:
    current: "1.35"
    aws_supported_versions: ["1.30", "1.31", "1.32", "1.33", "1.34", "1.35"]
    notify_on_update: true
    requires_aws_cli: true
    description: "Amazon EKS cluster version"

  terraform:
    current: "1.14.5"
    notify_on_update: true
    requires_aws_cli: false
    description: "Terraform version used in documentation"

# Database Versions
databases:
  aurora_mysql:
    current: "8.0.mysql_aurora.3.11.1"
    aws_available_versions_url: "https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.AuroraMysqlEngineVersion.html"
    notify_on_update: true
    requires_aws_cli: true
    fallback_method: "documentation_scraping"
    description: "Engine version for the aurora MySQL database we use"

# EKS Add-ons Versions (only non-Auto Mode managed add-ons)
# Note: CoreDNS, kube-proxy, VPC CNI, and EBS CSI Driver are managed by EKS Auto Mode
eks_addons:
  efs_csi_driver:
    current: "v2.3.0-eksbuild.1"
    notify_on_update: true
    requires_aws_cli: true
    aws_addon_name: "aws-efs-csi-driver"
    description: "EFS CSI Driver for persistent storage"

  metrics_server:
    current: "v0.8.1-eksbuild.1"
    notify_on_update: true
    requires_aws_cli: true
    aws_addon_name: "metrics-server"
    description: "Kubernetes Metrics Server for resource metrics"

# Terraform Modules
terraform_modules:
  terraform_aws:
    source: "hashicorp/aws"
    current: "6.28.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "Official AWS provider from Hashicorp for Terraform."

  terraform_kubernetes:
    source: "hashicorp/kubernetes"
    current: "3.0.1"
    notify_on_update: true
    requires_aws_cli: false
    description: "Official Kubernetes provider from Hashicorp for Terraform."

  aws_pod_identity:
    source: "terraform-aws-modules/eks-pod-identity/aws"
    current: "2.7.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "AWS provided module for EKS pod identities for Terraform."

  aws_eks:
    source: "terraform-aws-modules/eks/aws"
    current: "21.15.1"
    notify_on_update: true
    requires_aws_cli: false
    description: "AWS provided module for EKS for Terraform."

  aws_vpc:
    source: "terraform-aws-modules/vpc/aws"
    current: "6.6.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "AWS provided module for VPCs for Terraform."

# GitHub Workflow Actions Dependencies
github_workflows:
  actions_checkout:
    current: "v6.0.2"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for checking out code from a registry."

  actions_setup_python:
    current: "v6.2.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for setting up a specified Python version."

  actions_setup_go:
    current: "v6.2.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for setting up a specified Go version."

  actions_setup_terraform:
    current: "v3.1.2"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for setting up a specified Terraform version."

  actions_setup_kubectl:
    current: "v4.0.1"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for setting up a specified Kubectl version (azure/setup-kubectl)."

  actions_upload_artifact:
    current: "v6"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for uploading an artifact for storage."

  actions_download_artifact:
    current: "v7"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for downloading an artifact as part of a workflow."

  codeql_action:
    current: "v4"
    notify_on_update: true
    requires_aws_cli: false
    description: "Uploads the generated Trivy report in Sarif format to the Github Security tab."

  aws_configure_credentials:
    current: "v5"
    notify_on_update: true
    requires_aws_cli: false
    description: "Github action for configuring AWS credentials (aws-actions/configure-aws-credentials)."

  github_runner:
    current: "ubuntu-24.04"
    notify_on_update: true
    requires_aws_cli: false
    description: "GitHub-hosted runner environment (ubuntu-24.04)"

# Pre-commit Hooks Versions
pre_commit_hooks:
  pre_commit_hooks:
    current: "v6.0.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/pre-commit/pre-commit-hooks"

  black:
    current: "26.1.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/psf/black"

  isort:
    current: "8.0.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/pycqa/isort"

  flake8:
    current: "7.3.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/pycqa/flake8"

  bandit:
    current: "1.9.3"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/pycqa/bandit"

  terraform_hooks:
    current: "v1.105.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/antonbabenko/pre-commit-terraform"

  shellcheck:
    current: "v0.11.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/koalaman/shellcheck-precommit"

  markdownlint:
    current: "v0.47.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/igorshubovych/markdownlint-cli"

  yamllint:
    current: "v1.38.0"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/adrienverge/yamllint"

  commitizen:
    current: "v4.13.8"
    notify_on_update: true
    requires_aws_cli: false
    description: "https://github.com/commitizen-tools/commitizen"

# Semver Package Versions (used in workflows)
semver_packages:
  python_version:
    current: "3.14.3"
    notify_on_update: true
    requires_aws_cli: false
    description: "Version of Python used in Github CI/CD workflows."

  terraform_version:
    current: "1.14.5"
    notify_on_update: true
    requires_aws_cli: false
    description: "Version of Terraform used in Github CI/CD workflows."

  kubectl_version:
    current: "v1.35.1"
    notify_on_update: true
    requires_aws_cli: false
    description: "Version of Kubectl used in Github CI/CD workflows."

  semver:
    current: "3.0.4"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Version of the 'Semver' Python package used in Github CI/CD workflows."

# Go Package Dependencies (Console TUI)
go_packages:
  go_version:
    current: "1.25.5"
    notify_on_update: true
    requires_aws_cli: false
    description: "Go programming language version required for the console TUI application"
    min_version: "1.25"

  bubbletea:
    current: "v1.3.10"
    package_manager: "go"
    repository: "github.com/charmbracelet/bubbletea"
    notify_on_update: true
    requires_aws_cli: false
    description: "Bubbletea TUI framework for the console application"
    min_version: "v1.3.10"

  lipgloss:
    current: "v1.1.0"
    package_manager: "go"
    repository: "github.com/charmbracelet/lipgloss"
    notify_on_update: true
    requires_aws_cli: false
    description: "Lipgloss styling library for the console TUI"
    min_version: "v1.1.0"

# Python Package Dependencies (Warp Project + Credential Rotation)
python_packages:
  pymysql:
    current: "1.1.2"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Direct database access library for Warp and credential rotation tool"
    min_version: "1.1.2"

  boto3:
    current: "1.42.54"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "AWS SDK for Python - used by Warp (S3 data access) and credential rotation (Secrets Manager)"
    min_version: "1.42.54"

  requests:
    current: "2.32.5"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "HTTP library for credential rotation health check validation"
    min_version: "2.32.5"

  kubernetes:
    current: "35.0.0"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Kubernetes Python client for credential rotation K8s Secret patching and rolling restarts"
    min_version: "35.0.0"

  pytest:
    current: "9.0.2"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Testing framework for Warp and credential rotation projects"
    min_version: "9.0.1"

  pytest_cov:
    current: "7.0.0"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Pytest coverage plugin for Warp and credential rotation test suites"
    min_version: "7.0.0"

  flake8:
    current: "7.3.0"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Linting tool for Warp and credential rotation code quality checks"
    min_version: "7.0.0"

  black:
    current: "26.1.0"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Code formatter for Warp and credential rotation projects"
    min_version: "25.0.0"

  mypy:
    current: "1.19.1"
    package_manager: "pip"
    notify_on_update: true
    requires_aws_cli: false
    description: "Static type checker for Warp and credential rotation projects"
    min_version: "1.0.0"

# Monitoring Stack Versions
monitoring:
  prometheus_operator:
    current: "82.2.0"
    chart: "kube-prometheus-stack"
    notify_on_update: true
    requires_aws_cli: false
    description: "Hosts custom monitoring dashboards for the setup and integrates with pager duty for automated alerting."

  loki:
    current: "6.53.0"
    chart: "loki"
    repository: "grafana"
    notify_on_update: true
    requires_aws_cli: false
    description: "Loki for log aggregation."

  tempo:
    current: "2.4.2"
    chart: "tempo-distributed"
    repository: "grafana-community"
    notify_on_update: true
    requires_aws_cli: false
    description: "Tempo for distributed tracing with S3 storage in microservice mode (replaces Jaeger)."

  mimir:
    current: "6.0.5"
    chart: "mimir-distributed"
    repository: "grafana"
    notify_on_update: true
    requires_aws_cli: false
    description: "Mimir for long-term metrics storage with S3 backend."

  otebpf:
    current: "v0.4.1"
    chart: null
    repository: "otel/ebpf-instrument"
    docker_hub_url: "https://hub.docker.com/r/otel/ebpf-instrument"
    notify_on_update: true
    requires_aws_cli: false
    description: "OTeBPF (OpenTelemetry eBPF Instrumentation) for eBPF auto-instrumentation (deployed as DaemonSet, uses Docker Hub image)."


  cert_manager:
    current: "v1.19.1"
    chart: "cert-manager"
    repository: "jetstack"
    notify_on_update: true
    requires_aws_cli: false
    description: "cert-manager for TLS certificate management"

# Security Tools Versions (Zero-Tolerance Policy)
security_tools:
  trivy:
    current: "0.69.1"
    repository: "aquasecurity/trivy"
    notify_on_update: true
    requires_aws_cli: false
    description: "Trivy vulnerability, secret, and misconfiguration scanner"

  checkov:
    current: "3.2.504"
    package_manager: "pip"
    repository: "bridgecrewio/checkov"
    notify_on_update: true
    requires_aws_cli: false
    description: "Checkov IaC security scanner for Terraform, Kubernetes, Docker"

  kics:
    current: "v2.1.19"
    repository: "Checkmarx/kics"
    notify_on_update: true
    requires_aws_cli: false
    description: "KICS (Keeping Infrastructure as Code Secure) scanner"

  gosec:
    current: "v2.23.0"
    repository: "securego/gosec"
    notify_on_update: true
    requires_aws_cli: false
    description: "gosec Go security checker"

# Notification Settings
notifications:
  github_issues:
    enabled: true
    labels: ["version-update", "maintenance", "dependencies", "monthly-check"]
    create_for:
      - "applications"           # Core application Docker images (OpenEMR, Fluent Bit, Python)
      - "infrastructure"         # Infrastructure components (EKS cluster version, Terraform)
      - "terraform_modules"      # Terraform provider modules and AWS modules (AWS provider, Kubernetes provider, EKS module, VPC module, Pod Identity module)
      - "github_workflows"       # GitHub Actions dependencies used in CI/CD workflows (checkout, setup-python, setup-terraform, setup-kubectl, upload/download artifacts, CodeQL, Trivy, GitHub runner)
      - "pre_commit_hooks"       # Pre-commit hook tools for code quality (pre-commit-hooks, black, isort, flake8, bandit, terraform hooks, shellcheck, markdownlint, yamllint, commitizen)
      - "semver_packages"        # Semantic version packages used in workflows (Python version, Terraform version, kubectl version, semver Python package)
      - "go_packages"            # Go package dependencies for the console TUI (Go version, bubbletea, lipgloss)
      - "python_packages"        # Python package dependencies for Warp and credential rotation (pymysql, boto3, requests, kubernetes, pytest, pytest-cov, flake8, black, mypy)
      - "monitoring"             # Monitoring stack components (Prometheus Operator, Loki, Jaeger, cert-manager)
      - "eks_addons"             # EKS cluster add-ons managed outside of Auto Mode (EFS CSI Driver, Metrics Server)
      - "security_tools"         # Security scanning tools (Trivy, Checkov, KICS, gosec) - Zero-Tolerance Policy
    priority_threshold: "medium" # low, medium, high, critical
    monthly_schedule: true
    issue_title_template: "Version Check Report for Month of {month}"

# Logging Configuration
logging:
  enabled: true
  retention_days: 30
  log_level: "INFO"

# AWS CLI Configuration
aws_cli:
  required_for:
    - "aurora_mysql"
    - "eks_addons"
  optional_for:
    - "infrastructure"
  fallback_methods:
    aurora_mysql: "documentation_scraping"
    eks_addons: "hardcoded_versions"
  credentials_setup:
    environment_variables:
      - "AWS_ACCESS_KEY_ID"
      - "AWS_SECRET_ACCESS_KEY"
      - "AWS_REGION"
    github_secrets:
      - "AWS_ACCESS_KEY_ID"
      - "AWS_SECRET_ACCESS_KEY"
      - "AWS_REGION"
    aws_cli_config: "~/.aws/credentials"
    aws_cli_config_file: "~/.aws/config"
